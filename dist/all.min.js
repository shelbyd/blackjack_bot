(function(){var e,r;r=function(e){var r,a,d;for(r=e.length;r>0;)a=Math.floor(Math.random()*r),r-=1,d=e[a],e[a]=e[r],e[r]=d;return e},e=function(){function e(){}var a;return a=1e4,e.expectedValue=function(e){var d,n,t,o,C,i,f,m,u,c,l,v,w,s,y,h;s=(new Date).getTime(),h=[],l=e.cards;for(C in l)if(i=l[C],0!==i){u=e.removeCard(C),v=u.cards;for(f in v)if(m=v[f],0!==m){c=u.removeCard(f),w=c.cards;for(d in w)if(n=w[d],0!==n){if((new Date).getTime()-s>a)return 0;h.push({myCardOne:C,myCardTwo:f,dealerCard:d})}}}for(r(h),t=0,o=0;h.length&&(new Date).getTime()-s<a;)o+=1,y=h.pop(),t+=new GameState((new CardList).addCard(y.myCardOne).addCard(y.myCardTwo),(new CardList).addCard(y.dealerCard),e.removeCard(y.myCardOne).removeCard(y.myCardTwo).removeCard(y.dealerCard)).expectedValueOfBestPlay();return t/o},e}()}).call(this);
(function(){var t,i=function(t,i){return function(){return t.apply(i,arguments)}};t=function(){function t(t){this.toString=i(this.toString,this),this.cardCount=i(this.cardCount,this),this.tens=i(this.tens,this),this.nines=i(this.nines,this),this.eights=i(this.eights,this),this.sevens=i(this.sevens,this),this.sixs=i(this.sixs,this),this.fives=i(this.fives,this),this.fours=i(this.fours,this),this.threes=i(this.threes,this),this.twos=i(this.twos,this),this.aces=i(this.aces,this),this.removeCard=i(this.removeCard,this),this.addCard=i(this.addCard,this),this.withTen=i(this.withTen,this),this.withNine=i(this.withNine,this),this.withEight=i(this.withEight,this),this.withSeven=i(this.withSeven,this),this.withSix=i(this.withSix,this),this.withFive=i(this.withFive,this),this.withFour=i(this.withFour,this),this.withThree=i(this.withThree,this),this.withTwo=i(this.withTwo,this),this.withAce=i(this.withAce,this);var r,h,e;for(this.cards=t||{},r=0,h=s.length;h>r;r++)e=s[r],this.cards[e]=this.cards[e]||0}var s;return s=["ace","two","three","four","five","six","seven","eight","nine","ten"],t.shoe=function(i){return new t({ace:4*i,two:4*i,three:4*i,four:4*i,five:4*i,six:4*i,seven:4*i,eight:4*i,nine:4*i,ten:16*i})},t.prototype.withAce=function(){return this.addCard("ace")},t.prototype.withTwo=function(){return this.addCard("two")},t.prototype.withThree=function(){return this.addCard("three")},t.prototype.withFour=function(){return this.addCard("four")},t.prototype.withFive=function(){return this.addCard("five")},t.prototype.withSix=function(){return this.addCard("six")},t.prototype.withSeven=function(){return this.addCard("seven")},t.prototype.withEight=function(){return this.addCard("eight")},t.prototype.withNine=function(){return this.addCard("nine")},t.prototype.withTen=function(){return this.addCard("ten")},t.prototype.addCard=function(i){var r,h,e,n;for(r={},h=0,e=s.length;e>h;h++)n=s[h],r[n]=this.cards[n];return r[i]+=1,new t(r)},t.prototype.removeCard=function(i){var r,h,e,n;for(r={},h=0,e=s.length;e>h;h++)n=s[h],r[n]=this.cards[n];return r[i]-=1,new t(r)},t.prototype.aces=function(){return this.cards.ace},t.prototype.twos=function(){return this.cards.two},t.prototype.threes=function(){return this.cards.three},t.prototype.fours=function(){return this.cards.four},t.prototype.fives=function(){return this.cards.five},t.prototype.sixs=function(){return this.cards.six},t.prototype.sevens=function(){return this.cards.seven},t.prototype.eights=function(){return this.cards.eight},t.prototype.nines=function(){return this.cards.nine},t.prototype.tens=function(){return this.cards.ten},t.prototype.cardCount=function(t){var i,r,h;if(t)return this.cards[t];for(h=0,i=0,r=s.length;r>i;i++)t=s[i],h+=this.cards[t];return h},t.prototype.toString=function(){var t,i,r,h;for(h={},t=0,i=s.length;i>t;t++)r=s[t],this.cards[r]&&(h[r]=this.cards[r]);return h},t}()}).call(this);
(function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};t=function(){function t(t,s,n){this.my=t,this.dealer=s,this.unseen=n,this.doubleExpectedValue=e(this.doubleExpectedValue,this),this.hitExpectedValue=e(this.hitExpectedValue,this),this.standExpectedValue=e(this.standExpectedValue,this),this.bestPlayAndExpectedValue=e(this.bestPlayAndExpectedValue,this),this.expectedValueOfBestPlay=e(this.expectedValueOfBestPlay,this),this.bestPlay=e(this.bestPlay,this),this.myHand=e(this.myHand,this),this.dealerHand=e(this.dealerHand,this),this.push=e(this.push,this),this.lost=e(this.lost,this),this.over=e(this.over,this),this.won=e(this.won,this),this.expectedValue=e(this.expectedValue,this)}return t.prototype.expectedValue=function(){var e,s,n,i;if(this.lost())return-1;if(this.won())return this.myHand().blackjack()?1.5:1;if(this.push())return 0;if(0===this.unseen.cardCount())return-(1/0);e=0,n=this.unseen.cards;for(s in n)i=n[s],0!==this.unseen.cardCount(s)&&(e+=new t(this.my,this.dealer.addCard(s),this.unseen.removeCard(s)).expectedValue()*i);return e/this.unseen.cardCount()},t.prototype.won=function(){return this.over()&&!this.lost()&&!this.push()},t.prototype.over=function(){return this.dealer.cardCount()>=2&&this.dealerHand().value()>=17},t.prototype.lost=function(){return this.myHand().bust()?!0:this.myHand().value()<this.dealerHand().value()&&!this.dealerHand().bust()},t.prototype.push=function(){return this.over()&&this.myHand().value()===this.dealerHand().value()&&!this.myHand().bust()},t.prototype.dealerHand=function(){return new Hand(this.dealer)},t.prototype.myHand=function(){return new Hand(this.my)},t.prototype.bestPlay=function(){return this.bestPlayAndExpectedValue()[0]},t.prototype.expectedValueOfBestPlay=function(){return this.bestPlayAndExpectedValue()[1]},t.prototype.bestPlayAndExpectedValue=function(){var t,e,s;return s=this.standExpectedValue(),e=this.hitExpectedValue(),t=this.doubleExpectedValue(),s>e&&s>t?["stand",s]:e>t?["hit",e]:["double",t]},t.prototype.standExpectedValue=function(){return this.expectedValue()},t.prototype.hitExpectedValue=function(){var e,s,n,i;if(this.lost()||0===this.unseen.cardCount())return-(1/0);n=0,s=this.unseen.cards;for(e in s)i=s[e],0!==i&&(n+=new t(this.my.addCard(e),this.dealer,this.unseen.removeCard(e)).expectedValueOfBestPlay()*i);return n/this.unseen.cardCount()},t.prototype.doubleExpectedValue=function(){var e,s,n,i;if(this.my.cardCount()>2||0===this.unseen.cardCount())return-(1/0);n=0,s=this.unseen.cards;for(e in s)i=s[e],0!==i&&(n+=new t(this.my.addCard(e),this.dealer,this.unseen.removeCard(e)).standExpectedValue()*i);return 2*n/this.unseen.cardCount()},t}()}).call(this);
(function(){var t,i=function(t,i){return function(){return t.apply(i,arguments)}};t=function(){function t(t){this.cardList=t,this.blackjack=i(this.blackjack,this),this.bust=i(this.bust,this),this.value=i(this.value,this)}var s;return s={two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10},t.prototype.value=function(){var t,i,n,r,e,a;e=0;for(n in s)a=s[n],e+=a*this.cardList[n+"s"]();if(this.cardList.aces())for(t=i=1,r=this.cardList.aces();r>=1?r>=i:i>=r;t=r>=1?++i:--i)e+=11,e>21&&(e-=10);return e},t.prototype.bust=function(){return this.value()>21},t.prototype.blackjack=function(){return 1===this.cardList.aces()&&1===this.cardList.tens()},t}()}).call(this);