var BetCalculator,CardList,GameState,Hand,shuffle,bind=function(t,e){return function(){return t.apply(e,arguments)}};shuffle=function(t){var e,i,n;for(e=t.length;e>0;)i=Math.floor(Math.random()*e),e-=1,n=t[i],t[i]=t[e],t[e]=n;return t},BetCalculator=function(){function t(){}var e;return e=1e4,t.expectedValue=function(t){var i,n,s,r,h,a,d,o,u,c,p,f,l,y,b,w,v;y=(new Date).getTime(),w=[],p=t.cards;for(h in p)if(a=p[h],0!==a){u=t.removeCard(h),f=u.cards;for(d in f)if(o=f[d],0!==o){c=u.removeCard(d),l=c.cards;for(i in l)if(n=l[i],0!==n){if((new Date).getTime()-y>e)return 0;w.push({myCardOne:h,myCardTwo:d,dealerCard:i,weight:a*o*n})}}}for(shuffle(w),s=0,r=0;w.length&&(new Date).getTime()-y<e;)r+=1,b=w.pop(),v=new GameState((new CardList).addCard(b.myCardOne).addCard(b.myCardTwo),(new CardList).addCard(b.dealerCard),t.removeCard(b.myCardOne).removeCard(b.myCardTwo).removeCard(b.dealerCard)).expectedValueOfBestPlay()*b.weight,s+=v;return s/r},t}(),CardList=function(){function t(t){this.toString=bind(this.toString,this),this.cardCount=bind(this.cardCount,this),this.tens=bind(this.tens,this),this.nines=bind(this.nines,this),this.eights=bind(this.eights,this),this.sevens=bind(this.sevens,this),this.sixs=bind(this.sixs,this),this.fives=bind(this.fives,this),this.fours=bind(this.fours,this),this.threes=bind(this.threes,this),this.twos=bind(this.twos,this),this.aces=bind(this.aces,this),this.removeCard=bind(this.removeCard,this),this.addCard=bind(this.addCard,this),this.withTen=bind(this.withTen,this),this.withNine=bind(this.withNine,this),this.withEight=bind(this.withEight,this),this.withSeven=bind(this.withSeven,this),this.withSix=bind(this.withSix,this),this.withFive=bind(this.withFive,this),this.withFour=bind(this.withFour,this),this.withThree=bind(this.withThree,this),this.withTwo=bind(this.withTwo,this),this.withAce=bind(this.withAce,this);var i,n,s;for(this.cards=t||{},i=0,n=e.length;n>i;i++)s=e[i],this.cards[s]=this.cards[s]||0}var e;return e=["ace","two","three","four","five","six","seven","eight","nine","ten"],t.shoe=function(e){return new t({ace:4*e,two:4*e,three:4*e,four:4*e,five:4*e,six:4*e,seven:4*e,eight:4*e,nine:4*e,ten:16*e})},t.prototype.withAce=function(){return this.addCard("ace")},t.prototype.withTwo=function(){return this.addCard("two")},t.prototype.withThree=function(){return this.addCard("three")},t.prototype.withFour=function(){return this.addCard("four")},t.prototype.withFive=function(){return this.addCard("five")},t.prototype.withSix=function(){return this.addCard("six")},t.prototype.withSeven=function(){return this.addCard("seven")},t.prototype.withEight=function(){return this.addCard("eight")},t.prototype.withNine=function(){return this.addCard("nine")},t.prototype.withTen=function(){return this.addCard("ten")},t.prototype.addCard=function(i){var n,s,r,h;for(n={},s=0,r=e.length;r>s;s++)h=e[s],n[h]=this.cards[h];return n[i]+=1,new t(n)},t.prototype.removeCard=function(i){var n,s,r,h;for(n={},s=0,r=e.length;r>s;s++)h=e[s],n[h]=this.cards[h];return n[i]-=1,new t(n)},t.prototype.aces=function(){return this.cards.ace},t.prototype.twos=function(){return this.cards.two},t.prototype.threes=function(){return this.cards.three},t.prototype.fours=function(){return this.cards.four},t.prototype.fives=function(){return this.cards.five},t.prototype.sixs=function(){return this.cards.six},t.prototype.sevens=function(){return this.cards.seven},t.prototype.eights=function(){return this.cards.eight},t.prototype.nines=function(){return this.cards.nine},t.prototype.tens=function(){return this.cards.ten},t.prototype.cardCount=function(t){var i,n,s;if(t)return this.cards[t];for(s=0,i=0,n=e.length;n>i;i++)t=e[i],s+=this.cards[t];return s},t.prototype.toString=function(){var t,i,n,s;for(s={},t=0,i=e.length;i>t;t++)n=e[t],this.cards[n]&&(s[n]=this.cards[n]);return s},t}(),GameState=function(){function t(t,e,i){this.my=t,this.dealer=e,this.unseen=i,this.doubleExpectedValue=bind(this.doubleExpectedValue,this),this.hitExpectedValue=bind(this.hitExpectedValue,this),this.standExpectedValue=bind(this.standExpectedValue,this),this.bestPlayAndExpectedValue=bind(this.bestPlayAndExpectedValue,this),this.expectedValueOfBestPlay=bind(this.expectedValueOfBestPlay,this),this.bestPlay=bind(this.bestPlay,this),this.myHand=bind(this.myHand,this),this.dealerHand=bind(this.dealerHand,this),this.push=bind(this.push,this),this.lost=bind(this.lost,this),this.over=bind(this.over,this),this.won=bind(this.won,this),this.expectedValue=bind(this.expectedValue,this)}return t.prototype.expectedValue=function(){var e,i,n,s;if(this.lost())return-1;if(this.won())return this.myHand().blackjack()?1.5:1;if(this.push())return 0;if(0===this.unseen.cardCount())return-(1/0);e=0,n=this.unseen.cards;for(i in n)s=n[i],0!==this.unseen.cardCount(i)&&(e+=new t(this.my,this.dealer.addCard(i),this.unseen.removeCard(i)).expectedValue()*s);return e/this.unseen.cardCount()},t.prototype.won=function(){return this.over()&&!this.lost()&&!this.push()},t.prototype.over=function(){return this.dealer.cardCount()>=2&&this.dealerHand().value()>=17},t.prototype.lost=function(){return this.myHand().bust()?!0:this.myHand().value()<this.dealerHand().value()&&!this.dealerHand().bust()},t.prototype.push=function(){return this.over()&&this.myHand().value()===this.dealerHand().value()&&!this.myHand().bust()},t.prototype.dealerHand=function(){return new Hand(this.dealer)},t.prototype.myHand=function(){return new Hand(this.my)},t.prototype.bestPlay=function(){return this.bestPlayAndExpectedValue()[0]},t.prototype.expectedValueOfBestPlay=function(){return this.bestPlayAndExpectedValue()[1]},t.prototype.bestPlayAndExpectedValue=function(){var t,e,i;return i=this.standExpectedValue(),e=this.hitExpectedValue(),t=this.doubleExpectedValue(),i>e&&i>t?["stand",i]:e>t?["hit",e]:["double",t]},t.prototype.standExpectedValue=function(){return this.expectedValue()},t.prototype.hitExpectedValue=function(){var e,i,n,s;if(this.lost()||0===this.unseen.cardCount())return-(1/0);n=0,i=this.unseen.cards;for(e in i)s=i[e],0!==s&&(n+=new t(this.my.addCard(e),this.dealer,this.unseen.removeCard(e)).expectedValueOfBestPlay()*s);return n/this.unseen.cardCount()},t.prototype.doubleExpectedValue=function(){var e,i,n,s;if(this.my.cardCount()>2||0===this.unseen.cardCount())return-(1/0);n=0,i=this.unseen.cards;for(e in i)s=i[e],0!==s&&(n+=new t(this.my.addCard(e),this.dealer,this.unseen.removeCard(e)).standExpectedValue()*s);return 2*n/this.unseen.cardCount()},t}(),Hand=function(){function t(t){this.cardList=t,this.blackjack=bind(this.blackjack,this),this.bust=bind(this.bust,this),this.value=bind(this.value,this)}var e;return e={two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10},t.prototype.value=function(){var t,i,n,s,r,h;r=0;for(n in e)h=e[n],r+=h*this.cardList[n+"s"]();if(this.cardList.aces())for(t=i=1,s=this.cardList.aces();s>=1?s>=i:i>=s;t=s>=1?++i:--i)r+=11,r>21&&(r-=10);return r},t.prototype.bust=function(){return this.value()>21},t.prototype.blackjack=function(){return 1===this.cardList.aces()&&1===this.cardList.tens()},t}();