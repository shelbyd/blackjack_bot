var BasicStrategy,BetCalculator,CardList,Count,ExpectedValue,Gambit,GameState,Hand,expectedValueCache,expectedValue_,gambit,shuffle,bind=function(t,e){return function(){return t.apply(e,arguments)}};shuffle=function(t){var e,i,r;for(e=t.length;e>0;)i=Math.floor(Math.random()*e),e-=1,r=t[i],t[i]=t[e],t[e]=r;return t},BetCalculator=function(){function t(){}var e;return e=1e4,t.expectedValue=function(t){var i,r,n,s,a,h,o,u,d,c,l,p,f,C,b,y,v,w;b=(new Date).getTime(),v=[],p=t.cards;for(h in p)if(o=p[h],0!==o){c=t.removeCard(h),f=c.cards;for(u in f)if(d=f[u],0!==d){l=c.removeCard(u),C=l.cards;for(i in C)if(r=C[i],0!==r){if((new Date).getTime()-b>e)return 0;v.push({myCardOne:h,myCardTwo:u,dealerCard:i,weight:o*d*r})}}}for(v.sort(function(t,e){return t.weight-e.weight}),n=0,s=0;v.length&&(new Date).getTime()-b<e;)y=v.pop(),s+=y.weight,a=new GameState((new CardList).addCard(y.myCardOne).addCard(y.myCardTwo),(new CardList).addCard(y.dealerCard),t.removeCard(y.myCardOne).removeCard(y.myCardTwo).removeCard(y.dealerCard)),w=ExpectedValue.expectedValueOfBestPlay(a)*y.weight,n+=w;return n/s},t}(),CardList=function(){function t(t){this.getCards=bind(this.getCards,this),this.toString=bind(this.toString,this),this.cardCount=bind(this.cardCount,this),this.tens=bind(this.tens,this),this.nines=bind(this.nines,this),this.eights=bind(this.eights,this),this.sevens=bind(this.sevens,this),this.sixes=bind(this.sixes,this),this.sixs=bind(this.sixs,this),this.fives=bind(this.fives,this),this.fours=bind(this.fours,this),this.threes=bind(this.threes,this),this.twos=bind(this.twos,this),this.aces=bind(this.aces,this),this.removeCard=bind(this.removeCard,this),this.addCard=bind(this.addCard,this),this.withTen=bind(this.withTen,this),this.withNine=bind(this.withNine,this),this.withEight=bind(this.withEight,this),this.withSeven=bind(this.withSeven,this),this.withSix=bind(this.withSix,this),this.withFive=bind(this.withFive,this),this.withFour=bind(this.withFour,this),this.withThree=bind(this.withThree,this),this.withTwo=bind(this.withTwo,this),this.withAce=bind(this.withAce,this);var i,r,n;for(this.cards=t||{},i=0,r=e.length;r>i;i++)n=e[i],this.cards[n]=this.cards[n]||0}var e;return e=["ace","two","three","four","five","six","seven","eight","nine","ten"],t.shoe=function(e){return new t({ace:4*e,two:4*e,three:4*e,four:4*e,five:4*e,six:4*e,seven:4*e,eight:4*e,nine:4*e,ten:16*e})},t.fromList=function(e){var i,r,n,s;for(s={},r=0,n=e.length;n>r;r++)i=e[r],s[i]=s[i]||0,s[i]+=1;return new t(s)},t.prototype.withAce=function(){return this.addCard("ace")},t.prototype.withTwo=function(){return this.addCard("two")},t.prototype.withThree=function(){return this.addCard("three")},t.prototype.withFour=function(){return this.addCard("four")},t.prototype.withFive=function(){return this.addCard("five")},t.prototype.withSix=function(){return this.addCard("six")},t.prototype.withSeven=function(){return this.addCard("seven")},t.prototype.withEight=function(){return this.addCard("eight")},t.prototype.withNine=function(){return this.addCard("nine")},t.prototype.withTen=function(){return this.addCard("ten")},t.prototype.addCard=function(i){var r,n,s,a;for(r={},n=0,s=e.length;s>n;n++)a=e[n],r[a]=this.cards[a];return r[i]+=1,new t(r)},t.prototype.removeCard=function(i){var r,n,s,a;for(r={},n=0,s=e.length;s>n;n++)a=e[n],r[a]=this.cards[a];return r[i]-=1,new t(r)},t.prototype.aces=function(){return this.cards.ace},t.prototype.twos=function(){return this.cards.two},t.prototype.threes=function(){return this.cards.three},t.prototype.fours=function(){return this.cards.four},t.prototype.fives=function(){return this.cards.five},t.prototype.sixs=function(){return this.cards.six},t.prototype.sixes=function(){return this.cards.six},t.prototype.sevens=function(){return this.cards.seven},t.prototype.eights=function(){return this.cards.eight},t.prototype.nines=function(){return this.cards.nine},t.prototype.tens=function(){return this.cards.ten},t.prototype.cardCount=function(t){var i,r,n;if(t)return this.cards[t];for(n=0,i=0,r=e.length;r>i;i++)t=e[i],n+=this.cards[t];return n},t.prototype.toString=function(){var t,i,r,n;for(n={},t=0,i=e.length;i>t;t++)r=e[t],this.cards[r]&&(n[r]=this.cards[r]);return JSON.stringify(n)},t.prototype.getCards=function(){var t,i,r,n,s,a,h;for(h=[],i=0,n=e.length;n>i;i++)if(s=e[i],this.cards[s])for(t=r=1,a=this.cards[s];a>=1?a>=r:r>=a;t=a>=1?++r:--r)h.push(s);return h},t}(),GameState=function(){function t(t,e,i){this.my=t,this.dealer=e,this.unseen=i,this.splitAllowed=bind(this.splitAllowed,this),this.doubleAllowed=bind(this.doubleAllowed,this),this.hitAllowed=bind(this.hitAllowed,this),this.myHand=bind(this.myHand,this),this.dealerHand=bind(this.dealerHand,this),this.push=bind(this.push,this),this.lost=bind(this.lost,this),this.over=bind(this.over,this),this.won=bind(this.won,this)}return t.prototype.won=function(){return this.over()&&!this.lost()&&!this.push()},t.prototype.over=function(){return this.dealer.cardCount()>=2&&this.dealerHand().value()>=17},t.prototype.lost=function(){return this.myHand().bust()?!0:this.myHand().value()<this.dealerHand().value()&&!this.dealerHand().bust()},t.prototype.push=function(){return this.over()&&this.myHand().value()===this.dealerHand().value()&&!this.myHand().bust()},t.prototype.dealerHand=function(){return new Hand(this.dealer)},t.prototype.myHand=function(){return new Hand(this.my)},t.prototype.hitAllowed=function(){return!this.lost()&&0!==this.unseen.cardCount()&&!this.myHand().blackjack()},t.prototype.doubleAllowed=function(){return 2===this.my.cardCount()&&this.hitAllowed()},t.prototype.splitAllowed=function(){var t,e,i;if(!this.doubleAllowed())return!1;e=this.my.cards;for(t in e)if(i=e[t],2===i)return!0;return!1},t}(),Hand=function(){function t(t){this.cardList=t,this.isSoft=bind(this.isSoft,this),this.blackjack=bind(this.blackjack,this),this.bust=bind(this.bust,this),this.rawValue_=bind(this.rawValue_,this),this.value=bind(this.value,this)}var e;return e={two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,ace:11},t.prototype.value=function(){var t,e,i,r;if(r=this.rawValue_(),this.cardList.aces())for(t=e=1,i=this.cardList.aces();i>=1?i>=e:e>=i;t=i>=1?++e:--e)r>21&&(r-=10);return r},t.prototype.rawValue_=function(){var t,i,r;i=0;for(t in e)r=e[t],i+=r*this.cardList[t+"s"]();return i},t.prototype.bust=function(){return this.value()>21},t.prototype.blackjack=function(){return 1===this.cardList.aces()&&1===this.cardList.tens()},t.prototype.isSoft=function(){return!!this.cardList.aces()&&this.rawValue_()<=21},t}(),Gambit=function(){function t(t,e){this.bettor=t,this.strategy=e,this.liveShoe=bind(this.liveShoe,this),this.remainingCardCount=bind(this.remainingCardCount,this),this.updateShoe=bind(this.updateShoe,this),this.bet=bind(this.bet,this),this.blueMessage=bind(this.blueMessage,this),this.currentCardNumber=bind(this.currentCardNumber,this),this.play=bind(this.play,this),this.getDealerCards=bind(this.getDealerCards,this),this.getCard=bind(this.getCard,this),this.getCards=bind(this.getCards,this),this.getMyCards=bind(this.getMyCards,this),this.haveCards=bind(this.haveCards,this),this.loop=bind(this.loop,this),this.run=bind(this.run,this)}var e;return e={a:"ace",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine",t:"ten",j:"ten",q:"ten",k:"ten"},t.prototype.run=function(){return this.shoe=CardList.shoe(6),this.hands=[[21,22]],this.currentHand=0,setInterval(function(t){return function(){return t.loop()}}(this),1e3)},t.prototype.loop=function(){return 312===this.remainingCardCount()&&(console.log("Reshuffle!!!"),this.shoe=CardList.shoe(6)),"Place Your Bet"===this.blueMessage()?(this.hands=[[21,22]],this.currentHand=0,this.donePlaying=!1,this.updateShoe(),this.bet()):"Do You Want Insurance?"===this.blueMessage()?$(".js-reject-insurance").click():this.haveCards()?this.play():void 0},t.prototype.haveCards=function(){return this.getMyCards().cardCount()&&this.getDealerCards().cardCount()},t.prototype.getMyCards=function(){return this.lastMyCards=this.getCards(this.hands[this.currentHand]||[]),this.lastMyCards},t.prototype.getCards=function(t){return CardList.fromList(t.map(function(t){return function(e){return t.getCard(e)}}(this)).filter(function(t){return null!=t}))},t.prototype.getCard=function(t){var i;return i=$("#card-"+t+" .card-front"),i.length?i.attr("class").split(/\s+/).map(function(t){return function(t){return e[t.substr(5)]}}(this)).filter(function(t){return function(t){return null!=t}}(this))[0]:void 0},t.prototype.getDealerCards=function(){return this.lastDealerCards=this.currentHand>=this.hands.length?this.getCards([1,2,3,4,5,6,7,99999]):this.getCards([1,2,3,4,5,6,7]),this.lastDealerCards},t.prototype.play=function(){var t,e,i,r;return i=new GameState(this.getMyCards(),this.getDealerCards(),this.liveShoe()),r=this.strategy.bestPlay(i),"stand"===r?(this.currentHand+=1,null!=this.hands[this.currentHand]&&this.hands[this.currentHand].push(this.currentCardNumber()+1)):"split"===r?(e=this.hands[this.currentHand].pop(),this.hands[this.currentHand].push(this.currentCardNumber()+1),this.hands.push([e])):"hit"===r?this.hands[this.currentHand].push(this.currentCardNumber()+1):"double"===r&&(this.hands[this.currentHand].push(this.currentCardNumber()+1),this.currentHand+=1),t=".js-"+r,$(t).click()},t.prototype.currentCardNumber=function(){var t;return t=this.hands.map(function(t){return Math.max.apply(this,t)}),Math.max.apply(this,t)},t.prototype.blueMessage=function(){return $(".statuses .status.blue.show").text()},t.prototype.bet=function(){var t,e,i,r,n,s;for($(".value-1 .chip-1:last").click(),t=Math.max(Number.parseInt($("#points").text().replace(/[^\d]/g,""),10)/1e3,1),n=this.bettor.multiplier(this.liveShoe()),e=Math.max(Math.floor(t*n),1),i=r=1,s=e;s>=1?s>=r:r>=s;i=s>=1?++r:--r)$(".bet-main").click();return $(".js-deal").click()},t.prototype.updateShoe=function(){var t,e,i,r,n,s,a,h;if(null!=this.lastMyCards&&null!=this.lastDealerCards){for(s=this.lastMyCards.getCards(),e=0,r=s.length;r>e;e++)t=s[e],this.shoe=this.shoe.removeCard(t);for(a=this.lastDealerCards.getCards(),h=[],i=0,n=a.length;n>i;i++)t=a[i],h.push(this.shoe=this.shoe.removeCard(t));return h}},t.prototype.remainingCardCount=function(){return Number.parseInt($(".remaining-card-count").text(),10)},t.prototype.liveShoe=function(){var t,e,i,r,n,s,a,h;for(h=this.shoe,s=this.getMyCards().getCards(),e=0,r=s.length;r>e;e++)t=s[e],h=h.removeCard(t);for(a=this.getDealerCards().getCards(),i=0,n=a.length;n>i;i++)t=a[i],h=h.removeCard(t);return h},t}(),Count=function(){function t(){}return t.multiplier=function(t){var e;return e=this.count_(t),e/(t.cardCount()/52)+1},t.count_=function(t){var e,i;return i=t.twos()+t.threes()+t.fours()+t.fives()+t.sixes(),e=t.tens()+t.aces(),e-i},t}(),BasicStrategy=function(){function t(){}var e,i,r,n,s,a,h,o,u,d,c,l,p;return e=["two","three","four","five","six","seven","eight","nine","ten","ace"],h=function(){return"hit"},p=function(){return"stand"},s=function(t){return t.doubleAllowed()?"double":"hit"},d=function(){return"hit"},l=function(){return"stand"},a=function(t){return t.doubleAllowed()?"double":"stand"},u=function(){return"split"},o=function(){return"split"},c=function(){return"split"},n={4:[h,h,h,h,h,h,h,h,h,h],5:[h,h,h,h,h,h,h,h,h,h],6:[h,h,h,h,h,h,h,h,h,h],7:[h,h,h,h,h,h,h,h,h,h],8:[h,h,h,h,h,h,h,h,h,h],9:[h,s,s,s,s,h,h,h,h,h],10:[s,s,s,s,s,s,s,s,h,h],11:[s,s,s,s,s,s,s,s,s,s],12:[h,h,p,p,p,h,h,h,h,h],13:[p,p,p,p,p,h,h,h,h,h],14:[p,p,p,p,p,h,h,h,h,h],15:[p,p,p,p,p,h,h,h,d,d],16:[p,p,p,p,p,h,h,d,d,d],17:[p,p,p,p,p,p,p,p,p,l],18:[p,p,p,p,p,p,p,p,p,p],19:[p,p,p,p,p,p,p,p,p,p],20:[p,p,p,p,p,p,p,p,p,p],21:[p,p,p,p,p,p,p,p,p,p]},i={13:[h,h,h,s,s,h,h,h,h,h],14:[h,h,h,s,s,h,h,h,h,h],15:[h,h,s,s,s,h,h,h,h,h],16:[h,h,s,s,s,h,h,h,h,h],17:[h,s,s,s,s,h,h,h,h,h],18:[a,a,a,a,a,p,p,h,h,h],19:[p,p,p,p,a,p,p,p,p,p],20:[p,p,p,p,p,p,p,p,p,p],21:[p,p,p,p,p,p,p,p,p,p]},r={two:[u,u,o,o,o,o,h,h,h,h],three:[u,u,o,o,o,o,h,h,h,h],four:[h,h,h,u,u,h,h,h,h,h],five:n[10],six:[u,o,o,o,o,h,h,h,h,h],seven:[o,o,o,o,o,o,h,h,h,h],eight:[o,o,o,o,o,o,o,o,o,c],nine:[o,o,o,o,o,p,o,o,p,p],ten:n[20],ace:[o,o,o,o,o,o,o,o,o,o]},t.bestPlay=function(t){var s,a,h,o,u;return t.myHand().bust()?"stand":(h=t.myHand().value(),a=t.dealer.getCards()[0],o=t.myHand().isSoft(),s=t.splitAllowed(),u=s?r[t.my.getCards()[0]]:o?i[h]:n[h],u[e.indexOf(a)](t))},t}(),expectedValueCache={},expectedValue_=function(t){var e,i,r,n,s,a,h,o;if(n=t.my,e=t.dealer,h=t.unseen,r=""+n.toString()+e.toString()+h.toString(),!expectedValueCache[r]){i=0,a=h.cards;for(s in a)o=a[s],0!==h.cardCount(s)&&(i+=o*ExpectedValue.expectedValue(new GameState(n,e.addCard(s),h.removeCard(s))));expectedValueCache[r]=i/h.cardCount()}return expectedValueCache[r]},ExpectedValue=function(){function t(){}return t.expectedValue=function(t){return t.lost()?-1:t.push()?0:t.won()?t.myHand().blackjack()?1.5:1:0===t.unseen.cardCount()?-(1/0):expectedValue_(t)},t.bestPlay=function(t){return this.bestPlayAndExpectedValue(t).action},t.expectedValueOfBestPlay=function(t){return this.bestPlayAndExpectedValue(t).ev},t.bestPlayAndExpectedValue=function(t){var e,i,r,n;i={},i.stand=this.standExpectedValue(t),i.hit=this.hitExpectedValue(t),i["double"]=this.doubleExpectedValue(t),i.split=this.splitExpectedValue(t),e={ev:-(1/0)};for(r in i)n=i[r],n>e.ev&&(e={action:r,ev:n});return e},t.standExpectedValue=function(t){return this.expectedValue(t)},t.hitExpectedValue=function(t){var e,i,r,n;if(!t.hitAllowed())return-(1/0);r=0,i=t.unseen.cards;for(e in i)n=i[e],0!==n&&(r+=this.expectedValueOfBestPlay(this.afterIDraw(t,e))*n);return r/t.unseen.cardCount()},t.afterIDraw=function(t,e){return new GameState(t.my.addCard(e),t.dealer,t.unseen.removeCard(e))},t.doubleExpectedValue=function(t){return t.doubleAllowed()?2*this.hitExpectedValue(t):-(1/0)},t.splitExpectedValue=function(t){var e,i,r,n,s;if(!t.splitAllowed())return-(1/0);i=null,r=t.my.cards;for(e in r)s=r[e],2===s&&(i=e);return n=new GameState(t.my.removeCard(i),t.dealer,t.unseen),2*this.hitExpectedValue(n)},t}(),gambit=new Gambit(Count,BasicStrategy),gambit.run();